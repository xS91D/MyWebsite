<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½æŠ½æ¨‚</title>
    <link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css"/>
</head>
<body class="mdui-theme-primary-indigo mdui-theme-accent-pink mdui-appbar-with-toolbar">

    <div class="mdui-appbar mdui-appbar-fixed">
        <div class="mdui-toolbar mdui-color-theme">
            <span class="mdui-typo-headline">ğŸ æŠ½æŠ½æ¨‚ç³»çµ±</span>
            <div class="mdui-toolbar-spacer"></div>
        </div>
    </div>

    <div class="mdui-container mdui-m-t-4">
        <div class="mdui-row">
            <div class="mdui-col-md-5">
                <div class="mdui-card mdui-p-a-2">
                    <div class="mdui-card-primary">
                        <div class="mdui-card-primary-title">æŠ½çè¨­å®š</div>
                    </div>
                    
                    <div class="mdui-textfield mdui-textfield-floating-label">
                        <label class="mdui-textfield-label">çé …åç¨± (ä¾‹å¦‚ï¼šçå“1)</label>
                        <input class="mdui-textfield-input" type="text" id="prizeName" value="ç‰¹ç­‰ç"/>
                    </div>

                    <div class="mdui-textfield mdui-textfield-floating-label">
                        <label class="mdui-textfield-label">æŠ½å‡ºäººæ•¸</label>
                        <input class="mdui-textfield-input" type="number" id="drawCount" value="1" min="1"/>
                    </div>

                    <div class="mdui-textfield">
                        <label class="mdui-textfield-label">åƒèˆ‡åå–® (æ¯è¡Œä¸€å€‹äººå)</label>
                        <textarea class="mdui-textfield-input" rows="10" id="participantList" placeholder="è«‹è¼¸å…¥åå–®..."></textarea>
                    </div>

                    <div class="mdui-card-actions">
                        <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" onclick="startDraw()">é–‹å§‹æŠ½ç</button>
                        <button class="mdui-btn mdui-ripple" onclick="clearAll()">é‡ç½®</button>
                    </div>
                </div>
            </div>

            <div class="mdui-col-md-7">
                <div class="mdui-card mdui-p-a-2" style="min-height: 480px;">
                    <div class="mdui-card-primary">
                        <div class="mdui-card-primary-title">ä¸­çåå–®</div>
                    </div>
                    
                    <div id="resultArea" class="mdui-typo">
                        <p class="mdui-text-color-theme-secondary">å°šæœªé€²è¡ŒæŠ½ç...</p>
                    </div>

                    <div class="mdui-card-actions mdui-p-t-2" id="exportActions" style="display: none;">
                        <button class="mdui-btn mdui-btn-outlined mdui-ripple" onclick="exportResults()">åŒ¯å‡ºä¸­çåå–® (.txt)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script>
    <script>
        let currentResults = [];

        function startDraw() {
            const prize = document.getElementById('prizeName').value;
            const count = parseInt(document.getElementById('drawCount').value);
            const rawList = document.getElementById('participantList').value.trim();
            
            if (!rawList) {
                mdui.alert('è«‹å…ˆè¼¸å…¥åƒèˆ‡åå–®ï¼');
                return;
            }

            // éæ¿¾ç©ºç™½è¡Œä¸¦è½‰ç‚ºé™£åˆ—
            let participants = rawList.split('\n').map(name => name.trim()).filter(name => name !== "");

            if (participants.length < count) {
                mdui.alert(`åƒèˆ‡äººæ•¸ (${participants.length}) å°æ–¼æ¬²æŠ½å‡ºäººæ•¸ (${count})ï¼`);
                return;
            }

            // æ´—ç‰Œæ¼”ç®—æ³• (Fisher-Yates Shuffle)
            for (let i = participants.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [participants[i], participants[j]] = [participants[j], participants[i]];
            }

            // å–å‡ºå‰ N å
            currentResults = participants.slice(0, count);

            // æ¸²æŸ“ç•«é¢
            displayResults(prize);
        }

        function displayResults(prize) {
            const resultArea = document.getElementById('resultArea');
            const exportActions = document.getElementById('exportActions');
            
            let html = `<h3>çé …ï¼š${prize}</h3><ul class="mdui-list">`;
            currentResults.forEach((winner, index) => {
                html += `
                    <li class="mdui-list-item">
                        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-amber">stars</i>
                        <div class="mdui-list-item-content">
                            <div class="mdui-list-item-title">ç¬¬ ${index + 1} ä½ä¸­çè€…ï¼š<strong>${winner}</strong></div>
                        </div>
                    </li>`;
            });
            html += `</ul>`;
            
            resultArea.innerHTML = html;
            exportActions.style.display = 'block';
            
            mdui.snackbar({
                message: 'æŠ½çå®Œæˆï¼',
                position: 'right-top'
            });
        }

        function exportResults() {
            const prize = document.getElementById('prizeName').value;
            const content = `çé …ï¼š${prize}\nä¸­çæ™‚é–“ï¼š${new Date().toLocaleString()}\n------------------\n` + currentResults.join('\n');
            
            const blob = new Blob([content], { type: 'text/plain' });
            const anchor = document.createElement('a');
            anchor.download = `ä¸­çåå–®_${prize}.txt`;
            anchor.href = window.URL.createObjectURL(blob);
            anchor.click();
            window.URL.revokeObjectURL(anchor.href);
        }

        function clearAll() {
            document.getElementById('participantList').value = '';
            document.getElementById('resultArea').innerHTML = '<p class="mdui-text-color-theme-secondary">å°šæœªé€²è¡ŒæŠ½ç...</p>';
            document.getElementById('exportActions').style.display = 'none';
        }
    </script>
</body>
</html>